/*!
  jQuery Wookmark plugin
  @name jquery.wookmark.js
  @author Christoph Ono (chri@sto.ph or @gbks)
  @author Sebastian Helzle (sebastian@helzle.net or @sebobo)
  @version 1.4.3
  @date 8/25/2013
  @category jQuery plugin
  @copyright (c) 2009-2013 Christoph Ono (www.wookmark.com)
  @license Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
*/
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a);
}else{a(jQuery);}}(function(d){var a,b,c;c=function(e,f){return function(){return e.apply(f,arguments);};};b={align:"center",autoResize:false,comparator:null,container:d("body"),ignoreInactiveItems:true,itemWidth:0,fillEmptySpace:false,flexibleWidth:0,direction:undefined,offset:2,onLayoutChanged:undefined,outerOffset:0,resizeDelay:50};
a=(function(){function e(m,k){this.handler=m;this.columns=this.containerWidth=this.resizeTimer=null;this.activeItemCount=0;this.itemHeightsDirty=true;this.placeholders=[];
d.extend(true,this,b,k);this.update=c(this.update,this);this.onResize=c(this.onResize,this);this.onRefresh=c(this.onRefresh,this);this.getItemWidth=c(this.getItemWidth,this);
this.layout=c(this.layout,this);this.layoutFull=c(this.layoutFull,this);this.layoutColumns=c(this.layoutColumns,this);this.filter=c(this.filter,this);this.clear=c(this.clear,this);
this.getActiveItems=c(this.getActiveItems,this);this.refreshPlaceholders=c(this.refreshPlaceholders,this);this.sortElements=c(this.sortElements,this);var l=0,h=0,f={},n,g,o;
for(;l<m.length;l++){g=m.eq(l);n=g.data("filterClass");if(typeof n=="object"&&n.length>0){for(h=0;h<n.length;h++){o=d.trim(n[h]).toLowerCase();if(!(o in f)){f[o]=[];
}f[o].push(g[0]);}}}this.filterClasses=f;if(this.autoResize){d(window).bind("resize.wookmark",this.onResize);}this.container.bind("refreshWookmark",this.onRefresh);
}e.prototype.update=function(f){this.itemHeightsDirty=true;d.extend(true,this,f);};e.prototype.onResize=function(){clearTimeout(this.resizeTimer);this.itemHeightsDirty=this.flexibleWidth!==0;
this.resizeTimer=setTimeout(this.layout,this.resizeDelay);};e.prototype.onRefresh=function(){this.itemHeightsDirty=true;this.layout();};e.prototype.filter=function(l,t){var m=[],v,f=d(),r,p,o,h;
l=l||[];t=t||"or";if(l.length){for(r=0;r<l.length;r++){h=d.trim(l[r].toLowerCase());if(h in this.filterClasses){m.push(this.filterClasses[h]);}}v=m.length;
if(t=="or"||v==1){for(r=0;r<v;r++){f=f.add(m[r]);}}else{if(t=="and"){var n=m[0],s=true,g,u,q;for(r=1;r<v;r++){if(m[r].length<n.length){n=m[r];}}for(r=0;
r<n.length;r++){u=n[r];s=true;for(p=0;p<m.length&&s;p++){q=m[p];if(n==q){continue;}for(o=0,g=false;o<q.length&&!g;o++){g=q[o]==u;}s&=g;}if(s){f.push(n[r]);
}}}}this.handler.not(f).addClass("inactive");}else{f=this.handler;}f.removeClass("inactive");this.columns=null;this.layout();};e.prototype.refreshPlaceholders=function(g,h){var k=this.placeholders.length,m,p,f=this.columns.length,j,o,n,l,q=this.container.innerHeight();
for(;k<f;k++){m=d('<div class="wookmark-placeholder"/>').appendTo(this.container);this.placeholders.push(m);}l=this.offset+parseInt(this.placeholders[0].css("borderWidth"),10)*2;
for(k=0;k<this.placeholders.length;k++){m=this.placeholders[k];j=this.columns[k];if(k>=f||!j[j.length-1]){m.css("display","none");}else{p=j[j.length-1];
if(!p){continue;}n=p.data("wookmark-top")+p.data("wookmark-height")+this.offset;o=q-n-l;m.css({position:"absolute",display:o>0?"block":"none",left:k*g+h,top:n,width:g-l,height:o});
}}};e.prototype.getActiveItems=function(){return this.ignoreInactiveItems?this.handler.not(".inactive"):this.handler;};e.prototype.getItemWidth=function(){var k=this.itemWidth,f=this.container.width()-2*this.outerOffset,i=this.handler.eq(0),g=this.flexibleWidth;
if(this.itemWidth===undefined||this.itemWidth===0&&!this.flexibleWidth){k=i.outerWidth();}else{if(typeof this.itemWidth=="string"&&this.itemWidth.indexOf("%")>=0){k=parseFloat(this.itemWidth)/100*f;
}}if(g){if(typeof g=="string"&&g.indexOf("%")>=0){g=parseFloat(g)/100*f;}var h=~~(0.5+(f+this.offset)/(g+this.offset)),j=Math.min(g,~~((f-(h-1)*this.offset)/h));
k=Math.max(k,j);this.handler.css("width",k);}return k;};e.prototype.layout=function(g){if(!this.container.is(":visible")){return;}var h=this.getItemWidth()+this.offset,o=this.container.width(),n=o-2*this.outerOffset,j=~~((n+this.offset)/h),k=0,q=0,l=0,f=this.getActiveItems(),m=f.length,p;
if(this.itemHeightsDirty){for(;l<m;l++){p=f.eq(l);p.data("wookmark-height",p.outerHeight());}this.itemHeightsDirty=false;}j=Math.max(1,Math.min(j,m));k=this.outerOffset;
if(this.align=="center"){k+=~~(0.5+(n-(j*h-this.offset))>>1);}this.direction=this.direction||(this.align=="right"?"right":"left");if(!g&&this.columns!==null&&this.columns.length==j&&this.activeItemCount==m){q=this.layoutColumns(h,k);
}else{q=this.layoutFull(h,j,k);}this.activeItemCount=m;this.container.css("height",q);if(this.fillEmptySpace){this.refreshPlaceholders(h,k);}if(this.onLayoutChanged!==undefined&&typeof this.onLayoutChanged==="function"){this.onLayoutChanged();
}};e.prototype.sortElements=function(f){return typeof(this.comparator)==="function"?f.sort(this.comparator):f;};e.prototype.layoutFull=function(j,n,p){var u,q=0,o=0,f=d.makeArray(this.getActiveItems()),l=f.length,s=null,g=null,m={position:"absolute"},h,t=[],r=this.align=="left"?true:false;
this.columns=[];f=this.sortElements(f);while(t.length<n){t.push(this.outerOffset);this.columns.push([]);}for(;q<l;q++){u=d(f[q]);s=t[0];g=0;for(o=0;o<n;
o++){if(t[o]<s){s=t[o];g=o;}}h=p;if(g>0||!r){h+=g*j;}m[this.direction]=h;m.top=s;u.css(m).data("wookmark-top",s);t[g]+=u.data("wookmark-height")+this.offset;
this.columns[g].push(u);}return Math.max.apply(Math,t);};e.prototype.layoutColumns=function(g,n){var p=[],o=0,m=0,h,l,q,j,f;for(;o<this.columns.length;
o++){p.push(this.outerOffset);l=this.columns[o];f=o*g+n;h=p[o];for(m=0;m<l.length;m++){q=l[m];j={top:h};j[this.direction]=f;q.css(j).data("wookmark-top",h);
h+=q.data("wookmark-height")+this.offset;}p[o]=h;}return Math.max.apply(Math,p);};e.prototype.clear=function(){clearTimeout(this.resizeTimer);d(window).unbind("resize.wookmark",this.onResize);
this.container.unbind("refreshWookmark",this.onRefresh);};return e;})();d.fn.wookmark=function(e){if(!this.wookmarkInstance){this.wookmarkInstance=new a(this,e||{});
}else{this.wookmarkInstance.update(e||{});}this.wookmarkInstance.layout(true);return this.show();};}));